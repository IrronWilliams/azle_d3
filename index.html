<!DOCTYPE html>
<html>

<head>
<script src='http://code.jquery.com/jquery-3.3.1.min.js'></script>
<!--<script src='http://worldofdatascience.com/kedion.min.js'></script>-->
    <script src="../Kedion/main.js"></script>
</head>

<body>
</body>
</html>

<script>

load_script('scripts/wrapped_functions.js')

// ******* prepare page ********
load_fonts({
    "font": "Ubuntu"
})

style_body({
    "background": "rgb(85, 85, 85)",
    "font-family": "Ubuntu",
    "min-width": "1300px"
})

add_navigation_bar({
    "this_class": "my_nav"
})

style_navigation_bar('my_nav', 1, {
    "background-color": "rgba(91, 95, 100, 0.95)",
    "border-radius" : "4px",
    "margin-bottom" : "20px"
})

add_top_button({
    "this_class": "to_top_button",
    "text": "TOP",
    "side": "right"
})

add_layout('my_nav', 1, {
    "this_class": "nav_layout",
    "cell_class": "nav_layout_cells",
    "row_class": "nav_layout_rows",
    "number_of_rows": 1,
    "number_of_columns": 3
})

style_layout('nav_layout', 1, {
    "height": "90px",
    "column_widths": ['20%', '50%', '30%'],
    "border": 1
})

add_spa({
    "this_class" : "sections",
    "sections" : 3
})

all_style_spa('sections', {
    "background" : "rgba(91, 95, 100, 0.95)",
    "width" : "90%",
    "height" : "auto"
})

// ******* setting up layouts and styling that apply to all sections ********
call_multiple({
"iterations" : $('.sections').length,
"function" : `
	add_layout('sections', index + 1, {
    	"this_class": "section_1_layout",
    	"cell_class": "section_1_layout_cells",
    	"row_class": "section_1_layout_rows",
    	"number_of_rows": 1,
    	"number_of_columns": 2
	})
	all_style_layout('section_1_layout', {
    	"height": "auto",
    	"column_widths": ['20%', '80%'],
    	"border": 1
	})
	add_text('section_1_layout_cells', (index*2) + 1, {
   		"this_class" : "options_text",
    	"text" : "STYLE OPTIONS"
	})

	add_layout('section_1_layout_cells', (index*2) + 1, {
    	"this_class": "options_layout",
    	"cell_class": "options_layout_cells",
    	"row_class": "options_layout_rows",
    	"number_of_rows": 6,
    	"number_of_columns": 1
	})

`
})

// ******* adding all buttons ********
button_titles = ["bar_color", "text_color", "text_size", "padding-left", "bottom"]
call_wrapper_functions = ["bar_color()", "text_color()", "text_size()", "padding_left()", "bottom()"]
call_multiple({
	"iterations" : button_titles.length,
	"function" : `
	    add_button('options_layout_cells', index + 1, {
	        'this_class'  : 'option_button', 
	        'text' : button_titles[index]
	    })
	    all_style_button('option_button', {
	        "width" : "90%",
	        "background" : "rgb(16, 168, 180)"
	    })
	    add_event('option_button', index+1, {
	        "type" : "click", 
	        "function" : call_wrapper_functions[index]
	    })	    
`
})

// ******* adding section 1 D3 visual (see wrapped functions at bottom)********

add_d3_visual('section_1_layout_cells', 2, {
    "this_class" : "my_d3",
    "html_path" : "visuals/barchart.html",
    "wrapper_arguments" : ["../data/bar_data.tsv", "hello there", 30],
    "styles" : `
        style_d3_visual('my_d3', 1, {
            "width" : "100%",
            "height" : "500px",
            "bar_color" : "rgb(48, 229, 255)",
            "text_color" : "white"
        })
    `
})


// _all styles
all_style_text('options_text', {
    "color" : "white",
    "align" : "center",
    "font-size" : "20px"
})
all_style_layout('section_1_layout_cells', {
    "valign" : "top"
})
all_style_layout('options_layout_cells', {
    "halign" : "center"
})
all_style_layout('options_layout', {
    "border" : 0
})





// ************************************************************************ kedion functions
function add_d3_visual(target_class, target_instance, content) {
    add_iframe(target_class, target_instance, {
        "this_class" : content['this_class'],
        "source" : content['html_path']
    })
    $('.' + content['this_class']).eq(last_class_instance(content['this_class'])-1)[0].setAttribute("scrolling", "no");
    if(content.hasOwnProperty('wrapper_arguments')) {
    setTimeout(function(){
    arg_string = "'" + content['wrapper_arguments'].join("','") + "'"
    $('.' + content['this_class']).eq(1-1)[0].contentWindow.kedion_d3("draw_visual(" + arg_string + ")")
    },400)
    }
    if(content.hasOwnProperty('styles')) {
    setTimeout(function(){
    eval(content['styles'])
    },1000)
    }
    }

function style_d3_visual(target_class, target_instance, styles) {
     style_iframe(target_class, target_instance, {
         "width" : styles['width'],
         "height" : styles['height']
     })
     if(styles.hasOwnProperty('align')) {
         align_element(target_class, target_instance, styles['align'])
     }
     if(styles.hasOwnProperty('font-size')) {
         $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3("all_style_d3('text', {'font-size' : '" + styles['font-size'] + "'})")
     }
     if(styles.hasOwnProperty('bar_color')) {
         $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3("all_style_d3('.bar', {'fill' : '" + styles['bar_color'] + "'})")
     }
     if(styles.hasOwnProperty('text_color')) {
         $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3("all_style_d3('text', {'fill' : '" + styles['text_color'] + "'})")
     }
     if(styles.hasOwnProperty('text_size')) {
         $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3("all_style_d3('text', {'font-size' : '" + styles['text_size'] + "'})")
     }
     if(styles.hasOwnProperty('padding')) {
         $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3("all_style_d3('svg', {'padding' : '" + styles['padding'] + "'})")
     }
     if(styles.hasOwnProperty('padding-left')) {
         $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3("all_style_d3('svg', {'padding-left' : '" + styles['padding-left'] + "'})")
     }
     if(styles.hasOwnProperty('undefined')) {
         $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3("$('svg').attr('margin.bottom', '" + styles['cutoff'] + "')")
     }
     if(styles.hasOwnProperty('hover_color')) {
         call_str = `
         all_apply_id('bar');
         all_add_event('bar', {
         'type' : 'hover',
         'function' : "style_d3('.bar', get_target_instance(this.id), {'fill' : 'green'})"
	     })
	     all_add_event('bar', {
	     "type" : "unhover",
	     "function" : "style_d3('.bar', get_target_instance(this.id), {'fill' : 'steelblue'});"
	     })
	     `
         $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3(call_str)

     }


     }

function all_style_visual(target_class, styles) {
	$('.' + target_class).each(function(index) {
	style_visual(target_class, index, styles)
	});
	}


function call_d3_wrapper(target_class, target_instance, content) {
    arg_string = "'" + content['wrapper_arguments'].join("','") + "'"
    $('.' + target_class).eq(target_instance-1)[0].contentWindow.kedion_d3("$('svg').empty(); draw_visual(" + arg_string + ")")
}

    


</script>



